sap.ui.define(["sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/m/MessageToast"],function(e,t,r,s,i){"use strict";return{onInit:function(){var t=new e({sPricing:"",oReason:{},nBatchNo:0,nBatchCount:0,sFail_Message:"",oDateFor+
mat:sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyyMMdd"})});var r=this.getOwnerComponent().getModel();this.getView().setModel(t,"ScreenControl");this._getReason(r,this);var s=this.getView().byId("zlg.lo.sd.zl001::sap.suite.ui.generic.te+
mplate.ListReport.view.ListReport::ZEP_SALEDOCUMENT--listReportFilter")},onInitSmartFilterBarExtension:function(e){var t=e.getSource();var r=new Date;var s=new Date;s.setFullYear(s.getFullYear()-1);var i={CreationDate:{low:s,high:r}};t.setFilterData(i)},+
onPricingPress:function(){if(!this._pricingDialog){this._pricingDialog=sap.ui.xmlfragment("zlg.lo.sd.zl001.ext.fragments.RePricing",this)}this.getView().addDependent(this._pricingDialog);var e=this.getView().getModel(),t=this.getView().getModel("ScreenCo+
ntrol"),r=t.getProperty("/oDateFormat");var s=this.extensionAPI.getSelectedContexts(),i=this._checkDate(s,r);if(s.length>1&&!i){t.setProperty("/sPricing","")}else{var o=s[0].sDeepPath,a=e.getProperty(o);var n=r.format(a.CreationDate);t.setProperty("/sPri+
cing",n)}this._pricingDialog.open()},onPricingApprove:function(){var e=this.getView().getModel(),t=this.getView().getModel("ScreenControl");e.setUseBatch(true);e.setDeferredGroups(["batch_pricing"]);var r=sap.ui.getCore().byId("Pricing_date"),s=r.getValu+
e().replaceAll("-","").replaceAll("/","");if(!this._checkValidDate(r))return;var i=this.extensionAPI.getSelectedContexts(),o=this._createBatch(i);this._resetScreenModel(t,o);this._pricingDialog.setBusy(true);for(var a=0;a<o.length;a++){var n=o[a];for(var+
 g=0;g<n.length;g++){var l=n[g].sDeepPath,c=e.getProperty(l);e.callFunction("/UpdateDate",{method:"POST",groupId:"batch_pricing",changeSetId:"pricing_changeset",urlParameters:{SalesOrder:c.SalesOrder,pricing_date:s,reject_reason:""}})}this._pricingSubmit+
Change(e)}},onRejectPress:function(){if(!this._rejectDialog){this._rejectDialog=sap.ui.xmlfragment("zlg.lo.sd.zl001.ext.fragments.Reject",this)}this.getView().addDependent(this._rejectDialog);this._rejectDialog.open()},onPricingClose:function(){this._pri+
cingDialog.close();this._pricingDialog.destroy();this._pricingDialog=null},onRejectDialogPress:function(){var e=this.getView().getModel(),t=this.getView().getModel("ScreenControl");var r=this.extensionAPI.getSelectedContexts(),s=sap.ui.getCore().byId("re+
ason"),i=s.getSelectedKey();var o=t.getProperty("/oDateFormat"),a=o.format(new Date).replaceAll("-","").replaceAll("/","");var r=this.extensionAPI.getSelectedContexts(),n=this._createBatch(r);e.setUseBatch(true);e.setDeferredGroups(["rejectBatch"]);this.+
_rejectDialog.setBusy(true);this._resetScreenModel(t,n);for(var g=0;g<n.length;g++){var l=n[g];for(var c=0;c<l.length;c++){var h=l[c].sDeepPath,u=e.getProperty(h);e.callFunction("/Reject",{method:"POST",groupId:"rejectBatch",changeSetId:"reason_changeset+
",urlParameters:{SalesOrder:u.SalesOrder,pricing_date:a,reject_reason:i}})}this._rejectSubmitChange(e)}},onRejectCancel:function(){this._rejectDialog.close();this._rejectDialog.destroy();this._rejectDialog=null},_pricingSubmitChange:function(e){var t=thi+
s.getView().getModel("ScreenControl");e.submitChanges({groupId:"batch_pricing",success:function(e){var r=t.getProperty("/nBatchCount");var s=JSON.parse(e.__batchResponses[0].__changeResponses[0].headers["sap-message"]);t.setProperty("/nBatchCount",++r);t+
his._handleRequestError(s);this._createMessageDialog();var o=this.getView().getModel("ScreenControl").getProperty("/nBatchCount"),a=this.getView().getModel("ScreenControl").getProperty("/nBatchNo");if(o===a){this._pricingDialog.setBusy(false);this.onPric+
ingClose();var n=this.getView().getModel("ScreenControl").getProperty("/sFail_Message").substring(1);if(n){var g=this.getView().getModel("i18n").getResourceBundle().getText("requestFail");this.oErrorMessageDialog.getContent()[0].setText(g+n);this.oErrorM+
essageDialog.open()}else{var l=this.getView().getModel("i18n").getResourceBundle().getText("requestSuccess");i.show(l)}this.extensionAPI.refreshTable("zlg.lo.sd.zl001::sap.suite.ui.generic.template.ListReport.view.ListReport::ZEP_SALEDOCUMENT--listReport+
")}}.bind(this),error:function(e,t){this._pricingDialog.setBusy(false)}.bind(this)})},_rejectSubmitChange:function(e){var t=this.getView().getModel("ScreenControl");e.submitChanges({groupId:"rejectBatch",success:function(e){var r=t.getProperty("/nBatchCo+
unt");var s=JSON.parse(e.__batchResponses[0].__changeResponses[0].headers["sap-message"]);t.setProperty("/nBatchCount",++r);this._handleRequestError(s);this._createMessageDialog();var o=this.getView().getModel("ScreenControl").getProperty("/nBatchCount")+
,a=this.getView().getModel("ScreenControl").getProperty("/nBatchNo");if(o===a){this._rejectDialog.setBusy(false);this.onRejectCancel();var n=this.getView().getModel("ScreenControl").getProperty("/sFail_Message").substring(1);if(n){var g=this.getView().ge+
tModel("i18n").getResourceBundle().getText("requestFail");this.oErrorMessageDialog.getContent()[0].setText(g+n);this.oErrorMessageDialog.open()}else{var l=this.getView().getModel("i18n").getResourceBundle().getText("requestSuccess");i.show(l)}this.extens+
ionAPI.refreshTable("zlg.lo.sd.zl001::sap.suite.ui.generic.template.ListReport.view.ListReport::ZEP_SALEDOCUMENT--listReport")}}.bind(this),error:function(e,t){this._rejectDialog.setBusy(false)}})},_createMessageDialog:function(){if(!this.oErrorMessageDi+
alog){this.oErrorMessageDialog=new t({type:"Message",title:this.getView().getModel("i18n").getResourceBundle().getText("ErrorTitle"),state:"Error",content:new s({text:""}),beginButton:new r({type:"Emphasized",text:this.getView().getModel("i18n").getResou+
rceBundle().getText("okBtn"),press:function(){this.oErrorMessageDialog.close()}.bind(this)})})}},_checkValidDate:function(e){if(!e.isValidValue()||!e.getValue()){e.setValueState("Error");var t=this.getView().getModel("i18n").getResourceBundle().getText("+
invalidDate");e.setValueStateText(t);return false}else{e.setValueState("None");e.setValueStateText("");return true}},_checkDate:function(e,t){var r=this.getView().getModel();var s=e[0].sDeepPath,i=r.getProperty(s);var o=t.format(i.CreationDate);for(let a+
=0;a<e.length;a++){s=e[a].sDeepPath,i=r.getProperty(s);if(t.format(i.CreationDate)!==o){return false}}return true},_resetScreenModel:function(e,t){var r=t.length;e.setProperty("/nBatchNo",r);e.setProperty("/nBatchCount",0);e.setProperty("/sFail_Message",+
"")},_getReason:function(e,t){e.read("/ZI_SalesDocumentRjcnReason_VH",{success:function(e){this.getView().getModel("ScreenControl").setProperty("/Reason",e.results)}.bind(t),error:function(e){}.bind(t)})},_createBatch:function(e){var t=10;var r=[];for(va+
r s=0;s<e.length;s+=t){var i=e.slice(s,s+t);r.push(i)}return r},_handleRequestError:function(e){var t=e.details,r=e,s="";var i=[];if(t){for(var o=0;o<t.length;o++){var a=t[o].message;if(t[o].severity==="error"){i.push(a)}}}if(r.severity==="error"){i.push+
(r.message)}s=i.join();if(s){s=this.getView().getModel("ScreenControl").getProperty("/sFail_Message")+","+s;this.getView().getModel("ScreenControl").setProperty("/sFail_Message",s)}}}});                                                                     